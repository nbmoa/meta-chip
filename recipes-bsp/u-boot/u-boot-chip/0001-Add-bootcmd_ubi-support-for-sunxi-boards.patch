From 89d879ee30e60f03b590b4f8db0a2cb3f2b9d21f Mon Sep 17 00:00:00 2001
From: Drew Moseley <drew.moseley@northern.tech>
Date: Mon, 16 Jul 2018 18:05:11 -0400
Subject: [PATCH] Add bootcmd_ubi support for sunxi boards.

Signed-off-by: Drew Moseley <drew.moseley@northern.tech>
---
 include/configs/sunxi-common.h | 14 ++++++++++++++
 1 file changed, 14 insertions(+)

diff --git a/include/configs/sunxi-common.h b/include/configs/sunxi-common.h
index 412d0c7..9b8ba6a 100644
--- a/include/configs/sunxi-common.h
+++ b/include/configs/sunxi-common.h
@@ -482,8 +482,22 @@ extern int soft_i2c_gpio_scl;
 #define BOOTENV_DEV_NAME_FEL(devtypeu, devtypel, instance) \
 	"fel "
 
+/* UBI boot support */
+#define BOOTENV_DEV_UBI(devtypeu, devtypel, instance) \
+	"bootargs=root=ubi0:rootfs rootfstype=ubifs rw earlyprintk ubi.mtd=4\0" \
+	"bootcmd_ubi=" \
+		"mtdparts; " \
+                "ubi part UBI; " \
+                "ubifsmount ubi0:rootfs; " \
+                "ubifsload ${fdt_addr_r} /boot/sun5i-r8-chip.dtb; " \
+                "ubifsload ${kernel_addr_r} /boot/zImage; " \
+                "bootz ${kernel_addr_r} - ${fdt_addr_r}\0"
+#define BOOTENV_DEV_NAME_UBI(devtypeu, devtypel, instance) \
+	"ubi "
+
 #define BOOT_TARGET_DEVICES(func) \
 	func(FEL, fel, na) \
+	func(UBI, ubi, na) \
 	BOOT_TARGET_DEVICES_MMC(func) \
 	BOOT_TARGET_DEVICES_MMC_EXTRA(func) \
 	BOOT_TARGET_DEVICES_SCSI(func) \
-- 
2.7.4

